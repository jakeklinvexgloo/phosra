# Peacock — Phosra Integration Notes

**Platform:** Peacock (NBCUniversal)
**Assessment Date:** 2026-02-25
**Integration Priority:** Tier 1 (adapter already exists)
**Recommended Approach:** Hybrid (GraphQL API reads + Playwright writes)

---

## 1. Phosra Rule Category Coverage

Of Phosra's 45 enforcement rule categories, Peacock can enforce the following:

### Fully Enforceable (6 categories)

| Rule Category | Peacock Feature | Enforcement Method |
|---|---|---|
| `content_rating_filter` | Account-wide maturity tier (5 levels) | API read / Playwright write |
| `profile_lock` | 4-digit account-wide PIN | Playwright |
| `parental_consent_gate` | PIN required for control changes | Built-in (no Phosra action needed) |
| `age_gate` | Maturity tier acts as age gate | Playwright write |
| `viewing_history_access` | Per-profile Continue Watching | API read |
| `kids_profile` | Dedicated Kids profile type with restricted UI | Playwright (profile creation) |

### Partially Enforceable (4 categories — Phosra-managed workarounds)

| Rule Category | Gap | Phosra Workaround |
|---|---|---|
| `screen_time_limit` | No native support | Monitor Continue Watching activity, restrict access via PIN change or maturity level reduction when limit hit |
| `screen_time_report` | No usage dashboard | Aggregate Continue Watching data into Phosra's own reports. Limited accuracy — no timestamps or duration data from Peacock |
| `bedtime_schedule` | No native support | Change maturity level or PIN on schedule via cron-triggered Playwright. Account-wide impact is a concern |
| `parental_event_notification` | No native alerts | Phosra monitors Continue Watching and profile list, sends parent notifications for new viewing activity or new profile creation |

### Not Enforceable on Peacock

| Rule Category | Reason |
|---|---|
| `title_restriction` | Peacock does not support per-title blocking |
| `purchase_control` | Peacock is subscription-only; no in-app purchases to control |
| `social_control` | Peacock has no social features (no messaging, comments, friends) |
| `location_tracking` | Not applicable to streaming |
| `web_filtering` | Not applicable (content is curated, not user-generated) |
| `safe_search` | Not applicable |
| `app_control` | Not applicable (Peacock is one app, not an app store) |
| `custom_blocklist` / `custom_allowlist` | No title-level blocking mechanism available |
| `commercial_data_ban` | Not controllable from consumer side |
| `algorithmic_audit` | Not controllable from consumer side |
| `profanity_filter` | Peacock has no profanity filtering or audio muting |
| `autoplay_control` | Peacock does not expose an autoplay toggle in parental controls |

---

## 2. Enforcement Strategy

### Read Operations (GraphQL API — no browser needed)
```
GET profile list             -> GraphQL query via AppSync
GET maturity settings        -> GraphQL query (account-level)
GET Continue Watching        -> GraphQL query (per profile)
GET profile Kids status      -> GraphQL query
GET PIN status (set/not set) -> GraphQL query
```
- Use cached session tokens
- Standard GraphQL protocol — more predictable than Netflix's Falcor
- Run on schedule (every 4-6 hours) for monitoring
- Low detection risk — standard API consumption pattern

### Write Operations (Playwright — browser required, web-only controls)
```
SET maturity level        -> Playwright + PIN entry (account-wide)
SET/CHANGE PIN            -> Playwright (current PIN or password required)
CREATE Kids profile       -> Playwright (no auth needed — security gap)
```
- Requires browser context with stealth mode
- PIN entry is the only gate (no MFA — simpler than Netflix)
- All parental controls are web-only — mobile app does not expose these settings
- Rate limit: max 1 write session per hour

### Why Playwright for Writes (Not Direct API)
Peacock's parental controls are only accessible via the web browser interface. While the underlying GraphQL mutations likely exist, they are:
1. Not documented or publicly accessible
2. May require additional server-side validation tokens generated by the web UI
3. PIN entry flow is rendered client-side

Playwright automation of the web UI is the most reliable approach for write operations.

### Screen Time Enforcement (Phosra-managed)
```
1. Parent sets daily limit in Phosra (e.g., 2 hours)
2. Phosra polls Continue Watching via GraphQL every 30 minutes
3. Estimate activity from changes in Continue Watching list
4. When estimated limit reached:
   a. Option A (Kids profile): Lower maturity to "Little Kids" to further restrict
   b. Option B (any profile): Change account PIN to Phosra-generated value
   c. Notify parent via Phosra notification
5. Next day (or at parent's discretion):
   a. Restore original settings
   b. Reset daily counter
```

**Limitations of this approach:**
- Continue Watching data does not include timestamps or duration
- Estimation is based on list changes, not actual watch time
- 30-minute polling means significant potential overshoot
- Account-wide PIN changes affect all profiles (blunt instrument)
- Maturity level changes also affect all non-Kids profiles

---

## 3. Credential Storage Requirements

Phosra needs to store the following per family connection:

| Credential | Purpose | Sensitivity |
|---|---|---|
| Peacock email | Login | High |
| Peacock password | Login + initial PIN setup | Critical |
| Session tokens | API reads, avoid re-login | High (rotate periodically) |
| Account PIN | Write operations (parental control changes) | High |
| Profile IDs | Map Phosra child to Peacock profile | Low |
| Phosra-managed PIN | Screen time enforcement (if PIN is changed) | Medium |

### Security Considerations
- All credentials must be encrypted at rest (AES-256)
- Session tokens should be stored encrypted with per-user keys
- Password should never be logged or included in error reports
- PIN is only 4 digits — treat as high sensitivity despite low entropy
- Account PIN must be stored to automate write operations (unlike Netflix where MFA codes are ephemeral)
- Consider using Phosra's vault service for credential management

---

## 4. OAuth Assessment

**Peacock does not offer any partner OAuth or third-party API access.**

- No developer portal or API program
- No OAuth redirect flow
- No API keys or partner tokens
- No public GraphQL schema documentation
- All integration requires credential-based authentication

This means:
- Phosra must store user's Peacock email + password
- User must explicitly consent to credential storage
- Re-authentication needed when sessions expire
- Higher UX friction vs platforms with OAuth
- Identical constraint as Netflix — no streaming platform currently offers parental control OAuth

---

## 5. Adapter Gap Analysis

### Capabilities Peacock Lacks (compared to Netflix)

| Feature | Netflix | Peacock | Impact on Phosra |
|---|---|---|---|
| Per-title blocking | Yes | No | Cannot enforce `title_restriction` rule category |
| Per-profile maturity | Yes (per profile) | No (account-wide for non-Kids) | Cannot set different maturity levels for different children unless using Kids profiles |
| MFA on control changes | Yes | No (PIN only) | Simpler automation, but weaker security |
| Viewing activity export | Yes (CSV) | No | Less data available for Phosra reports |
| Viewing timestamps | Yes (date) | No | Cannot accurately track when content was watched |
| Autoplay control | Yes | No | Cannot manage binge-watching via autoplay toggle |
| Profanity filter | No | No | Neither platform supports this |
| Screen time controls | No | No | Neither platform supports this natively |

### Capabilities Peacock Has That Help

| Feature | Benefit for Phosra |
|---|---|
| 5 maturity tiers (vs Netflix's 4) | More granular age-based filtering — "Family" tier is useful for 9-12 age group |
| GraphQL API | Standard protocol, better tooling than Netflix's Falcor |
| No MFA on writes | Simpler Playwright automation, fewer failure modes |
| 6 profiles (vs Netflix's 5) | Room for more child profiles |
| Kids profile auto-restriction | Strong default restrictions without additional configuration |

### Critical Gaps for Compliance

1. **No per-title blocking** — Cannot comply with regulations requiring specific content blocking (e.g., blocking a specific show with inappropriate content for one child but allowing it for another)
2. **Account-wide maturity** — If a parent wants different restriction levels for a 9-year-old and a 15-year-old, they must use Kids profiles for the younger child (which locks to TV-PG/PG max) and accept the account-wide setting for the older child
3. **No profanity filter** — Cannot address language-specific parental concerns
4. **Weak viewing history** — Compliance reporting is limited by lack of timestamps and duration data
5. **Profile creation bypass** — No password required to create profiles; children can create unrestricted profiles

---

## 6. Key Differences from Netflix Adapter

### Architecture Differences

| Component | Netflix Adapter | Peacock Adapter |
|---|---|---|
| **API Protocol** | Falcor (proprietary JSON Graph) | GraphQL via AppSync (standard) |
| **Authentication** | Session cookies + MSL tokens + CSRF headers | Session cookies/tokens (simpler) |
| **Write Gate** | MFA (3 methods: email, SMS, password) | PIN only (4-digit) |
| **Profile Granularity** | Per-profile maturity + per-profile PIN | Account-wide maturity + account-wide PIN |
| **Title Restrictions** | Per-profile block list (behind MFA) | Not supported |
| **Bot Detection** | Aggressive (fingerprinting, behavioral analysis) | Standard AWS WAF |
| **Mobile Apps** | Parental controls in app | Web-only parental controls |

### Implementation Implications

1. **Simpler session management:** No MSL tokens or CSRF handling needed
2. **Simpler write operations:** PIN entry vs MFA code retrieval — no need to integrate with email/SMS providers
3. **Fewer write capabilities:** No title blocking, no per-profile settings — less to implement, but less to offer
4. **Account-wide side effects:** Every write operation potentially affects all profiles — must document and warn users
5. **Profile monitoring needed:** Must actively watch for new profile creation as a bypass vector (Netflix doesn't have this issue since profile creation requires password)
6. **Weaker monitoring data:** Continue Watching is a poor substitute for Netflix's timestamped viewing activity — Phosra reports for Peacock will be less detailed

### Development Approach
1. **Reuse patterns from Netflix adapter:** Session management, Playwright automation framework, stealth configuration
2. **Replace Falcor with GraphQL:** Use standard GraphQL client libraries instead of custom Falcor parsing
3. **Simplify MFA to PIN:** Remove MFA handling code, replace with PIN entry flow
4. **Add profile creation monitor:** New component not needed for Netflix
5. **Reduce write scope:** No title restriction setter needed; maturity setter is account-wide
6. **Adjust reporting:** Account for weaker data availability in Phosra compliance reports

---

## 7. API Accessibility Reality Check

### Complete Absence of Any API Path

Peacock represents the **worst-case API accessibility scenario** among major streaming platforms. The platform has even less API accessibility than Netflix:

- **No public API has ever existed.** NBCUniversal's developer portal (`developer.nbcuniversal.com`) no longer resolves — the domain returns DNS failures.
- **No partner program** of any kind — no OAuth, no delegated access, no API keys, no webhook system.
- **No developer documentation** — no published endpoints, no schemas, no rate limits.
- **Internal APIs are HMAC-gated** — unlike Netflix, where session cookies alone enable read access, Peacock requires HMAC signatures on every GraphQL request. These signatures use runtime keys that must be extracted from the JavaScript bundle via dynamic instrumentation tools like Frida.
- **GraphQL introspection is disabled in production** — the schema cannot be discovered via standard tooling. All queries must be reverse-engineered from network traffic capture.
- **JWT tokens expire ~4 hours** with ~30-day refresh tokens.
- **All parental control writes are web-only** — not available in mobile apps, making browser automation the only write path at any level.

**Per-capability summary: ZERO capabilities have any form of API access** — not even unofficial read-only access for viewing history. This is strictly worse than Netflix, where session cookie-authenticated reads work for profile data and viewing history.

### HMAC Authentication Barrier

The HMAC signature requirement is the defining technical barrier for Peacock:

1. Every GraphQL request must include an HMAC-signed header
2. The signing key is embedded in the JavaScript bundle and changes with deployments
3. Extracting the key requires runtime analysis (Frida or similar dynamic instrumentation)
4. The key must be re-extracted whenever Peacock deploys a new frontend version
5. Incorrect HMAC signatures result in immediate 401/403 responses

This means the "GraphQL API for reads" strategy described in previous sections is significantly harder than originally assessed. The practical implication is that **Playwright-based reads (DOM scraping within an authenticated browser context) may be more reliable than direct API calls** — the browser handles HMAC signing automatically.

### Household Sharing Detection Risks

Since November 2024, Peacock enforces household sharing restrictions that directly impact Phosra's automation:

| Risk | Scenario | Consequence |
|---|---|---|
| **IP flagging** | Phosra's cloud servers make API/browser calls from data center IPs | Account flagged for out-of-household access; verification prompt or block |
| **Geolocation mismatch** | Phosra server in us-east-1, user household in California | Sessions flagged as geographically inconsistent |
| **Device telemetry anomaly** | Playwright browser fingerprint differs from user's real devices | Behavioral anomaly detection triggers review |
| **Concurrent sessions** | Phosra automation running while user watches on their device | May count against stream limit (1-3 depending on plan) |

**Mitigation hierarchy:**
1. **Best:** Local agent on household WiFi network — eliminates all IP/geo concerns
2. **Good:** Residential proxy in user's metro area — reduces IP risk significantly
3. **Acceptable:** Cloud execution with consistent fingerprint and human-like timing — highest detection risk
4. **Unacceptable:** Cloud execution without stealth measures — near-certain detection

### What Bark, Qustodio, and Other Apps Actually Do with Peacock

No parental control app has achieved any level of direct Peacock integration:

| App | Peacock-Specific Features | Actual Approach |
|---|---|---|
| **Bark** | None | Monitors device notifications for Peacock-related alerts. Cannot see content watched |
| **Qustodio** | None | Can block the Peacock app at the device level. Sets device-level time limits. Zero content visibility |
| **Mobicip** | None | Device-level app blocking and time schedules. No Peacock content awareness |
| **Canopy** | None | Web filtering and device screen time. No streaming-specific integration |
| **Safes** | None | App usage tracking (open/close times). Cannot see what is watched on Peacock |
| **Google Family Link** | None | Can restrict Peacock app installation/usage on Android. No content controls |
| **Apple Screen Time** | None | Can set time limits on Peacock app. No content controls |

**Conclusion:** The entire parental control industry treats Peacock as an opaque, uncontrollable app. Phosra's browser automation approach would be a first-of-its-kind integration. This is both a competitive advantage and a risk — no one has validated this approach at scale.

### Regulatory Context

Emerging child safety legislation may change the API accessibility landscape:

| Regulation | Relevant Requirement | Potential Impact on Peacock API Access |
|---|---|---|
| **KOSA (Kids Online Safety Act)** | Platforms must provide parents with tools to supervise minors' use | Could mandate API or interoperability requirements for parental control tools |
| **EU Digital Services Act (DSA)** | Transparency obligations for very large platforms | Could require Peacock to publish content classification APIs |
| **California AADC** | Age-appropriate design obligations | Could require Peacock to expose parental control APIs |
| **UK Age Appropriate Design Code** | Best interests of child users | Could pressure Peacock to enable third-party parental control integration |

**Current reality:** No regulation currently mandates that Peacock provide API access for parental control apps. All existing requirements focus on platform-provided controls, not third-party interoperability. However, KOSA's "duty to enable parental tools" language, if interpreted broadly, could create a legal basis for demanding API access.

### Risk Matrix for Browser Automation Approach

| Risk | Likelihood | Impact | Mitigation | Residual Risk |
|---|---|---|---|---|
| **ToS violation — account suspension** | Low | High (user loses Peacock access) | Stealth mode, human-like timing, user consent | Medium |
| **ToS violation — legal action** | Very Low | Very High (cease & desist) | Legal review, user indemnification clause | Low |
| **Household sharing detection** | Medium | Medium (verification prompt disrupts automation) | Local agent or residential proxy | Low-Medium |
| **HMAC key rotation breaks API reads** | Medium | Medium (fallback to Playwright reads) | Monitor for key changes, dual-path architecture | Low |
| **Peacock UI redesign breaks Playwright selectors** | Medium | High (adapter fully broken until updated) | Selector resilience, automated regression tests | Medium |
| **JWT token expiry during operation** | Low | Low (retry with refresh token) | Token lifecycle management, proactive refresh | Very Low |
| **Stream limit conflict** | Low | Low (user gets kicked from stream) | Check active streams before automation | Very Low |
| **Peacock adds aggressive bot detection** | Low | High (adapter becomes unreliable) | Stealth hardening, behavioral randomization | Medium |

### Comparison: Netflix vs Peacock API Accessibility

| Dimension | Netflix | Peacock | Winner for Phosra |
|---|---|---|---|
| **Historical public API** | Yes (2008-2014, deprecated) | Never existed | Netflix |
| **Developer portal** | Deprecated but was documented | Domain defunct | Netflix |
| **Unofficial API reads** | Session cookies sufficient | HMAC signatures required | **Netflix (significantly)** |
| **Unofficial API writes** | Possible (MFA-gated) | Undocumented, HMAC-gated | Netflix |
| **Schema discovery** | Partial (Falcor path exploration) | Disabled (no introspection) | Netflix |
| **Viewing history access** | Yes (timestamps, per-profile) | Continue Watching only (no timestamps) | **Netflix (significantly)** |
| **Bot detection** | Aggressive (custom fingerprinting) | Standard (AWS WAF) | **Peacock** |
| **MFA complexity** | High (3 methods) | None (PIN only) | **Peacock (significantly)** |
| **Household sharing enforcement** | Aggressive (since 2023) | Active (since Nov 2024) | Peacock (slightly) |
| **Parental control write complexity** | High (MFA + per-profile) | Medium (PIN + account-wide) | **Peacock** |
| **Feature coverage** | Rich (per-title, per-profile) | Limited (account-wide only) | **Netflix (significantly)** |
| **Parental control app integrations** | None direct | None at any level | Tie (both zero) |
| **Overall API accessibility score** | 3/10 | **1/10** | **Netflix** |

### Strategic Implications for Phosra

1. **Playwright-first architecture is mandatory** — Unlike Netflix where a hybrid (API reads + Playwright writes) strategy works, Peacock's HMAC barrier means Playwright is the primary tool for both reads and writes.

2. **HMAC implementation is an optional upgrade, not a prerequisite** — If Phosra invests in HMAC key extraction and signing, direct GraphQL reads become possible and more efficient. But the adapter should launch with Playwright-only and treat HMAC as a performance optimization.

3. **Local agent model is strongly recommended** — Given household sharing detection, running Playwright from the user's home network is far safer than cloud-based execution. This is a bigger architectural consideration for Peacock than for Netflix.

4. **Competitive moat is real** — No parental control app has achieved Peacock integration. If Phosra succeeds, it would be the first, creating a genuine competitive advantage. The technical barriers (HMAC, no API, web-only controls) are the same barriers keeping competitors out.

5. **Regulatory tailwind is possible but uncertain** — KOSA and EU DSA could eventually force Peacock to provide API access, making the browser automation approach temporary. But there is no timeline for this, and Phosra should not depend on regulatory changes.
