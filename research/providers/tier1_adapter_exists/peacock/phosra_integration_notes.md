# Peacock — Phosra Integration Notes

**Platform:** Peacock (NBCUniversal)
**Assessment Date:** 2026-02-25
**Integration Priority:** Tier 1 (adapter already exists)
**Recommended Approach:** Hybrid (GraphQL API reads + Playwright writes)

---

## 1. Phosra Rule Category Coverage

Of Phosra's 45 enforcement rule categories, Peacock can enforce the following:

### Fully Enforceable (6 categories)

| Rule Category | Peacock Feature | Enforcement Method |
|---|---|---|
| `content_rating_filter` | Account-wide maturity tier (5 levels) | API read / Playwright write |
| `profile_lock` | 4-digit account-wide PIN | Playwright |
| `parental_consent_gate` | PIN required for control changes | Built-in (no Phosra action needed) |
| `age_gate` | Maturity tier acts as age gate | Playwright write |
| `viewing_history_access` | Per-profile Continue Watching | API read |
| `kids_profile` | Dedicated Kids profile type with restricted UI | Playwright (profile creation) |

### Partially Enforceable (4 categories — Phosra-managed workarounds)

| Rule Category | Gap | Phosra Workaround |
|---|---|---|
| `screen_time_limit` | No native support | Monitor Continue Watching activity, restrict access via PIN change or maturity level reduction when limit hit |
| `screen_time_report` | No usage dashboard | Aggregate Continue Watching data into Phosra's own reports. Limited accuracy — no timestamps or duration data from Peacock |
| `bedtime_schedule` | No native support | Change maturity level or PIN on schedule via cron-triggered Playwright. Account-wide impact is a concern |
| `parental_event_notification` | No native alerts | Phosra monitors Continue Watching and profile list, sends parent notifications for new viewing activity or new profile creation |

### Not Enforceable on Peacock

| Rule Category | Reason |
|---|---|
| `title_restriction` | Peacock does not support per-title blocking |
| `purchase_control` | Peacock is subscription-only; no in-app purchases to control |
| `social_control` | Peacock has no social features (no messaging, comments, friends) |
| `location_tracking` | Not applicable to streaming |
| `web_filtering` | Not applicable (content is curated, not user-generated) |
| `safe_search` | Not applicable |
| `app_control` | Not applicable (Peacock is one app, not an app store) |
| `custom_blocklist` / `custom_allowlist` | No title-level blocking mechanism available |
| `commercial_data_ban` | Not controllable from consumer side |
| `algorithmic_audit` | Not controllable from consumer side |
| `profanity_filter` | Peacock has no profanity filtering or audio muting |
| `autoplay_control` | Peacock does not expose an autoplay toggle in parental controls |

---

## 2. Enforcement Strategy

### Read Operations (GraphQL API — no browser needed)
```
GET profile list             -> GraphQL query via AppSync
GET maturity settings        -> GraphQL query (account-level)
GET Continue Watching        -> GraphQL query (per profile)
GET profile Kids status      -> GraphQL query
GET PIN status (set/not set) -> GraphQL query
```
- Use cached session tokens
- Standard GraphQL protocol — more predictable than Netflix's Falcor
- Run on schedule (every 4-6 hours) for monitoring
- Low detection risk — standard API consumption pattern

### Write Operations (Playwright — browser required, web-only controls)
```
SET maturity level        -> Playwright + PIN entry (account-wide)
SET/CHANGE PIN            -> Playwright (current PIN or password required)
CREATE Kids profile       -> Playwright (no auth needed — security gap)
```
- Requires browser context with stealth mode
- PIN entry is the only gate (no MFA — simpler than Netflix)
- All parental controls are web-only — mobile app does not expose these settings
- Rate limit: max 1 write session per hour

### Why Playwright for Writes (Not Direct API)
Peacock's parental controls are only accessible via the web browser interface. While the underlying GraphQL mutations likely exist, they are:
1. Not documented or publicly accessible
2. May require additional server-side validation tokens generated by the web UI
3. PIN entry flow is rendered client-side

Playwright automation of the web UI is the most reliable approach for write operations.

### Screen Time Enforcement (Phosra-managed)
```
1. Parent sets daily limit in Phosra (e.g., 2 hours)
2. Phosra polls Continue Watching via GraphQL every 30 minutes
3. Estimate activity from changes in Continue Watching list
4. When estimated limit reached:
   a. Option A (Kids profile): Lower maturity to "Little Kids" to further restrict
   b. Option B (any profile): Change account PIN to Phosra-generated value
   c. Notify parent via Phosra notification
5. Next day (or at parent's discretion):
   a. Restore original settings
   b. Reset daily counter
```

**Limitations of this approach:**
- Continue Watching data does not include timestamps or duration
- Estimation is based on list changes, not actual watch time
- 30-minute polling means significant potential overshoot
- Account-wide PIN changes affect all profiles (blunt instrument)
- Maturity level changes also affect all non-Kids profiles

---

## 3. Credential Storage Requirements

Phosra needs to store the following per family connection:

| Credential | Purpose | Sensitivity |
|---|---|---|
| Peacock email | Login | High |
| Peacock password | Login + initial PIN setup | Critical |
| Session tokens | API reads, avoid re-login | High (rotate periodically) |
| Account PIN | Write operations (parental control changes) | High |
| Profile IDs | Map Phosra child to Peacock profile | Low |
| Phosra-managed PIN | Screen time enforcement (if PIN is changed) | Medium |

### Security Considerations
- All credentials must be encrypted at rest (AES-256)
- Session tokens should be stored encrypted with per-user keys
- Password should never be logged or included in error reports
- PIN is only 4 digits — treat as high sensitivity despite low entropy
- Account PIN must be stored to automate write operations (unlike Netflix where MFA codes are ephemeral)
- Consider using Phosra's vault service for credential management

---

## 4. OAuth Assessment

**Peacock does not offer any partner OAuth or third-party API access.**

- No developer portal or API program
- No OAuth redirect flow
- No API keys or partner tokens
- No public GraphQL schema documentation
- All integration requires credential-based authentication

This means:
- Phosra must store user's Peacock email + password
- User must explicitly consent to credential storage
- Re-authentication needed when sessions expire
- Higher UX friction vs platforms with OAuth
- Identical constraint as Netflix — no streaming platform currently offers parental control OAuth

---

## 5. Adapter Gap Analysis

### Capabilities Peacock Lacks (compared to Netflix)

| Feature | Netflix | Peacock | Impact on Phosra |
|---|---|---|---|
| Per-title blocking | Yes | No | Cannot enforce `title_restriction` rule category |
| Per-profile maturity | Yes (per profile) | No (account-wide for non-Kids) | Cannot set different maturity levels for different children unless using Kids profiles |
| MFA on control changes | Yes | No (PIN only) | Simpler automation, but weaker security |
| Viewing activity export | Yes (CSV) | No | Less data available for Phosra reports |
| Viewing timestamps | Yes (date) | No | Cannot accurately track when content was watched |
| Autoplay control | Yes | No | Cannot manage binge-watching via autoplay toggle |
| Profanity filter | No | No | Neither platform supports this |
| Screen time controls | No | No | Neither platform supports this natively |

### Capabilities Peacock Has That Help

| Feature | Benefit for Phosra |
|---|---|
| 5 maturity tiers (vs Netflix's 4) | More granular age-based filtering — "Family" tier is useful for 9-12 age group |
| GraphQL API | Standard protocol, better tooling than Netflix's Falcor |
| No MFA on writes | Simpler Playwright automation, fewer failure modes |
| 6 profiles (vs Netflix's 5) | Room for more child profiles |
| Kids profile auto-restriction | Strong default restrictions without additional configuration |

### Critical Gaps for Compliance

1. **No per-title blocking** — Cannot comply with regulations requiring specific content blocking (e.g., blocking a specific show with inappropriate content for one child but allowing it for another)
2. **Account-wide maturity** — If a parent wants different restriction levels for a 9-year-old and a 15-year-old, they must use Kids profiles for the younger child (which locks to TV-PG/PG max) and accept the account-wide setting for the older child
3. **No profanity filter** — Cannot address language-specific parental concerns
4. **Weak viewing history** — Compliance reporting is limited by lack of timestamps and duration data
5. **Profile creation bypass** — No password required to create profiles; children can create unrestricted profiles

---

## 6. Key Differences from Netflix Adapter

### Architecture Differences

| Component | Netflix Adapter | Peacock Adapter |
|---|---|---|
| **API Protocol** | Falcor (proprietary JSON Graph) | GraphQL via AppSync (standard) |
| **Authentication** | Session cookies + MSL tokens + CSRF headers | Session cookies/tokens (simpler) |
| **Write Gate** | MFA (3 methods: email, SMS, password) | PIN only (4-digit) |
| **Profile Granularity** | Per-profile maturity + per-profile PIN | Account-wide maturity + account-wide PIN |
| **Title Restrictions** | Per-profile block list (behind MFA) | Not supported |
| **Bot Detection** | Aggressive (fingerprinting, behavioral analysis) | Standard AWS WAF |
| **Mobile Apps** | Parental controls in app | Web-only parental controls |

### Implementation Implications

1. **Simpler session management:** No MSL tokens or CSRF handling needed
2. **Simpler write operations:** PIN entry vs MFA code retrieval — no need to integrate with email/SMS providers
3. **Fewer write capabilities:** No title blocking, no per-profile settings — less to implement, but less to offer
4. **Account-wide side effects:** Every write operation potentially affects all profiles — must document and warn users
5. **Profile monitoring needed:** Must actively watch for new profile creation as a bypass vector (Netflix doesn't have this issue since profile creation requires password)
6. **Weaker monitoring data:** Continue Watching is a poor substitute for Netflix's timestamped viewing activity — Phosra reports for Peacock will be less detailed

### Development Approach
1. **Reuse patterns from Netflix adapter:** Session management, Playwright automation framework, stealth configuration
2. **Replace Falcor with GraphQL:** Use standard GraphQL client libraries instead of custom Falcor parsing
3. **Simplify MFA to PIN:** Remove MFA handling code, replace with PIN entry flow
4. **Add profile creation monitor:** New component not needed for Netflix
5. **Reduce write scope:** No title restriction setter needed; maturity setter is account-wide
6. **Adjust reporting:** Account for weaker data availability in Phosra compliance reports
